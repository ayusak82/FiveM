# ng-deathnotify

FiveM用の死亡通知システム。プレイヤーが死亡した際に、キーバインドを使用して医療支援の要請やテレポート機能を提供します。

## 機能

### 基本機能
- **死亡状態の自動検知** - プレイヤーの死亡状態を監視し、適切なアクションを有効化
- **キー長押しシステム** - 3秒間のキー長押しで各機能を実行
- **クールダウン機能** - 15秒間のクールダウンで機能の乱用を防止
- **ps-dispatch連携** - 医療職への自動通知システム

### 利用可能なアクション

#### **Fキー - 医療施設への搬送**
- **対象**: 特定の職業のみ（デフォルト: police）
- **機能**: 設定された医療施設への瞬時テレポート
- **通知**: ps-dispatchで緊急医療搬送として医療職に通知

#### **Gキー - 救急医療要請**
- **対象**: 全プレイヤー
- **機能**: 救急医療サービス（ambulance/ems）への通知
- **通知**: ps-dispatchで一般市民の医療要請として通知

#### **Hキー - 個人医要請**
- **対象**: 全プレイヤー
- **機能**: 個人医（doctor）への通知
- **通知**: ps-dispatchで個人医要請として通知

## 必要な依存関係

```lua
dependencies {
    'qb-core',
    'ox_lib',
    'oxmysql',
    'ps-dispatch'
}
```

## インストール方法

1. **ファイル配置**
   ```
   resources/[your-folder]/ng-deathnotify/
   ├── fxmanifest.lua
   ├── client/
   │   └── main.lua
   ├── server/
   │   └── main.lua
   └── shared/
       └── config.lua
   ```

2. **server.cfg に追加**
   ```
   ensure ng-deathnotify
   ```

3. **依存関係の確認**
   - qb-core が正常に動作していること
   - ox_lib が導入されていること
   - ps-dispatch が設定されていること

## 設定

### `shared/config.lua`

#### テレポート設定
```lua
Config.TeleportJobs = {
    ['police'] = {
        coords = vector4(363.66, -592.98, 43.28, 68.63),
        label = '病院'
    },
    -- 他の職業を追加可能
}
```

#### 基本設定
```lua
Config.HoldTime = 3000  -- キー長押し時間（ミリ秒）
Config.Debug = false    -- デバッグモードの有効/無効
```

#### 通知設定
各アクションの通知内容をカスタマイズ可能：
```lua
Config.Notifications = {
    ambulanceCall = {
        title = '医療要請',
        message = '市民が医療支援を要請しています',
        code = '10-69',
        icon = 'fas fa-face-dizzy'
    },
    -- その他の通知設定...
}
```

## 使用方法

### プレイヤー向け操作

1. **死亡時の操作**
   - プレイヤーが死亡状態になると、自動的にキーバインドが有効化されます

2. **キー操作**
   - **F**: （特定職業のみ）医療施設への搬送
   - **G**: 救急医療サービスを呼ぶ
   - **H**: 個人医を呼ぶ

3. **操作手順**
   - 該当キーを3秒間長押し
   - プログレスサークルが表示されます
   - 完了すると自動的に機能が実行されます

### 医療職向け

- ps-dispatchを通じて通知を受信
- 通知タイプに応じて適切な対応を実施
- 緊急度に応じて優先度が設定されています

## トラブルシューティング

### よくある問題

1. **キーが反応しない**
   - プレイヤーが実際に死亡状態になっているか確認
   - 依存関係（特にox_lib）が正常に動作しているか確認

2. **テレポートできない**
   - プレイヤーの職業がConfig.TeleportJobsに設定されているか確認
   - 座標が正しく設定されているか確認

3. **通知が届かない**
   - ps-dispatchが正常に動作しているか確認
   - 対象の職業（ambulance/doctor）がオンラインか確認

### デバッグモード

```lua
Config.Debug = true
```

デバッグモードを有効にすると、コンソールに詳細なログが出力されます。

## カスタマイズ

### 新しい職業の追加

```lua
Config.TeleportJobs = {
    ['police'] = {
        coords = vector4(363.66, -592.98, 43.28, 68.63),
        label = '病院'
    },
    ['firefighter'] = {
        coords = vector4(300.0, -600.0, 43.0, 90.0),
        label = '消防署医務室'
    }
}
```

### 医療職の追加

```lua
Config.MedicalJobs = {
    'ambulance',
    'doctor',
    'ems',
    'paramedic'  -- 新しい職業を追加
}
```

## 技術仕様

- **フレームワーク**: QBCore
- **UI**: ox_lib（プログレスサークル、通知）
- **通知システム**: ps-dispatch
- **データベース**: oxmysql（将来の拡張用）
- **Lua バージョン**: 5.4

## ライセンス

このスクリプトは教育目的で提供されています。商用利用の際は適切なライセンス確認を行ってください。

## サポート

問題が発生した場合は、以下を確認してください：
1. 依存関係が全て正常に動作しているか
2. 設定ファイルが正しく記述されているか
3. デバッグモードでエラーログを確認

---

**作者**: NCCGr  
**バージョン**: 1.0.0  
**対応フレームワーク**: QBCore